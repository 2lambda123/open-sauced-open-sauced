on: push
name: Publish stories if changed
jobs:
  checkChangesInDocs:
    if: github.repository	== 'bdougie/open-sauced'
    name: Check changes in stories
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Check changes in stories
      uses: netlify/actions/diff-includes@ffb5acd488eee1f642442bc18ede41459195b138
      with:
        args: stories
#   publish:
#     needs: checkChangesInDocs
#     name: Publish
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@master
#     - name: Publish
#       run: |
#         sudo npm install netlify-cli -g
#         sudo netlify deploy --site $BUILD_DIR --auth $NETLIFY_AUTH_TOKEN

#       env:
#         BUILD_DIR: storybook-static
#         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#         NETLIFY_SITE_ID: sauced-components
#         NETLIFY_CMD: npm run build-storybook
#         NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}

  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master

    - name: Build and Deploy
      uses: JamesIves/github-pages-deploy-action@master
      env:
        ACCESS_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        BRANCH: gh-pages
        FOLDER: storybook-static
        BUILD_SCRIPT: npm run build-storybook
